{% extends "base.html" %}

{% block title %}CRFMS - Create Reservation{% endblock %}

{% block header_title %}â• Create New Reservation{% endblock %}

{% block content %}
<div class="content">
    <h2>Reservation Details</h2>
    
    <form method="POST" style="max-width: 800px; margin: 30px auto;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="form-group">
                <label for="vehicle_class">ğŸš— Vehicle Class *</label>
                <select name="vehicle_class" id="vehicle_class" required>
                    <option value="">Select class...</option>
                    {% for vc in vehicle_classes %}
                    <option value="{{ vc.name }}">{{ vc.name }} - ${{ vc.base_rate.amount }}/day</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="location">ğŸ“ Pickup Location *</label>
                <select name="location" id="location" required>
                    <option value="">Select location...</option>
                    {% for location in locations %}
                    <option value="{{ location.name }}">{{ location.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="form-group">
                <label for="pickup_date">ğŸ“… Pickup Date & Time *</label>
                <input type="datetime-local" name="pickup_date" id="pickup_date" required>
            </div>

            <div class="form-group">
                <label for="return_date">ğŸ“… Return Date & Time *</label>
                <input type="datetime-local" name="return_date" id="return_date" required>
            </div>
        </div>

        <div class="form-group">
            <label for="insurance">ğŸ›¡ï¸ Insurance Tier *</label>
            <select name="insurance" id="insurance" required>
                <option value="None">No Insurance</option>
                {% for ins in insurances %}
                <option value="{{ ins.name }}">{{ ins.name }} - ${{ ins.daily_fee.amount }}/day</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>ğŸ Add-Ons (Optional)</label>
            <div class="checkbox-group">
                {% for addon in addons %}
                <div class="checkbox-item">
                    <input type="checkbox" name="addons" value="{{ addon.name }}" id="addon_{{ addon.name }}">
                    <label for="addon_{{ addon.name }}" style="margin: 0; font-weight: normal;">
                        {{ addon.name }} (+${{ addon.daily_fee.amount }}/day)
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>

        <div style="background: #e7f3ff; border-left: 4px solid #2196F3; padding: 20px; margin: 20px 0; border-radius: 5px;">
            <h4 style="color: #2196F3; margin-bottom: 10px;">ğŸ’¡ Reservation Information</h4>
            <ul style="margin-left: 20px; color: #555;">
                <li>A deposit of $200 will be required</li>
                <li>Insurance and add-ons are optional but recommended</li>
                <li>You'll receive a confirmation notification via email</li>
                <li>Actual vehicle will be assigned at pickup</li>
            </ul>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 30px;">
            <button type="submit" class="btn btn-success" style="flex: 1; padding: 15px; font-size: 16px;">
                âœ… Create Reservation
            </button>
            <a href="/reservations" class="btn btn-danger" style="padding: 15px 30px; font-size: 16px;">
                âŒ Cancel
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Set minimum date to today
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('pickup_date').min = now.toISOString().slice(0, 16);
    document.getElementById('return_date').min = now.toISOString().slice(0, 16);
    
    // Update return date minimum when pickup date changes
    document.getElementById('pickup_date').addEventListener('change', function() {
        document.getElementById('return_date').min = this.value;
    });
</script>
{% endblock %}
